回路が全然分からなくなってきた。

何故モータードライバーは必要なのか？
→
・モーターの回転方向を制御する
・PWMでモーターの回転速度を制御
・マイコンの出力は許容電流が少なく、直接制御すると大電流を要するモータは動作できなかったり過電流となるおそれがある
・電源断後のモータによる逆起電力でマイコンが故障するおそれがある

単純に、モーターに乾電池を繋いだだけでもモーターを回すことはできる。
しかし、回転方向や、回転速度を制御することはできない。
それを制御するために、モータードライバーは必要。
それだけでなく、マイコンの代わりにモータに電源を供給する役割もある。
マイコンの出力ピンにモーターを直接繋いでも、電流値が足りないばかりか、
マイコンの許容電流以上の電流を流そうとして過電流になり、マイコンを壊してしまう可能性がある。
それを防ぐために、マイコンの電源系とモーターの電源系は分けて、後者はモータドライバーにつける。
ちなみに、マイコン(RX220)の出力許容電圧値は、
通常出力時でも4mA。高出力時には16mA。

また、過電流だけでなく、逆起電力対策も行う必要がある。
逆起電力(逆起電圧)(サージ)とは、コイルを使用した誘導性の負荷状態でOFFした際に、負荷から発生する逆方向起電圧のこと。
モーターを手回しすると発電する仕組みのこと。
この逆起電力は、電源の反対方向に発生するため、ショットキーバリアダイオードを用いて、回路を保護する必要があるらしい。
DRV8835(IC)のデータシートにも、FET付近にダイオードの表記がある。

https://monoist.itmedia.co.jp/mn/articles/1603/04/news042.html

--------------------------------------------

過電流対策
・マイコンには消費電流が大きいものを繋がない
-少量のLEDくらいにしておく
-基本的に外部電源を使用するドライバ回路を使う
・マイコンの1ピンあたりの上限電流値程度まで電流を制限できる微小定電流源をマイコンの電源にする
-直流安定化電源をショートさせても、定電流モードになって焼けないのと原理は一緒
-しかし、そんな便利に使えるものがあるのかどうか
-そもそもマイコンが動かなくなるのでは？
・出力ピンにはゲート抵抗をつける
-MOSFETが焼けてGND直結となったとしても、ゲート抵抗が負荷になって焼けるほどの電流が流れないようにできる
・電流制限抵抗を付ける
-ゲート抵抗と実質同じ効果
・極小のヒューズを使う
-20mAとか32mAのヒューズがあるみたい
-現実問題として、マイコンにヒューズなんていちいち使ってられるか！！！！とは思う

過電圧対策
-モーターや電磁石があるときはサージキラーを入れる
-フォトカプラ等を用いて絶縁

--------------------------------------------
マイコンを使った回路での電流計算が分からない

・ちゃんと電流は足りるのか？→安定化電源を用いて、全てをフル稼働させた場合の消費電流を確認する。
・マイコンが燃えないか？(逆にどうやったら燃える？)
→定格以上の出力電流出したら燃える。
→回路の不備や故障等で、大電流が流れ込んできたら燃える。
・要求電流が高すぎてすぐにバッテリーが切れてしまわないか？
→モーターやLEDテープ等の、マイコンのポートから出る電流だけでは足りないものは、ドライバーを使用する。

マイコンの出力増強をアシストしてくれる「ドライバ」
マイコンのIOポートに、LEDを繋いで電流制限用の抵抗を直列に接続すると、LEDを点灯させたり消灯したりできる。
しかし、ポートが出力したり吸い込んだりできる電流や電圧には限界がある。
大きな電流を必要とするLEDを光らせたり、12Vを超えるモーターを駆動するには、電圧や電流の能力を増強しなければならない。
このような増強用ICまたは回路をドライバという。ドライバを構成するには、トランジスタを組み合わせたり、
標準ロジックICや専用ドライバICを使ったりする。

マイコン内臓RGBLEDモジュール(AE-WS2812B)を使う場合を考える。
最大値(256,256,256)で使う場合、1個でも50mA消費する。モジュールを繋げるほど消費電流は上がる。
(64,64,64)以内で制御する場合、電流を抑えることができ、64個のLEDを(64,64,64)で光らせると600mAほど。

https://www.marutsu.co.jp/pc/static/large_order/WS2812B_0124?srsltid=AfmBOoo_J_YjlMU_hhnhPqBsiq5hEkdtjuPHg4sfIkIEnD2hZe-I1E6C






